{"version":3,"sources":["../../../../src/server/lib/incremental-cache/file-system-cache.ts"],"names":["LRUCache","path","NEXT_CACHE_TAGS_HEADER","memoryCache","tagsManifest","FileSystemCache","constructor","ctx","fs","flushToDisk","serverDistDir","appDir","_appDir","revalidatedTags","maxMemoryCacheSize","max","length","value","JSON","kind","stringify","props","Error","data","body","html","pageData","tagsManifestPath","join","loadTagsManifest","parse","readFileSync","toString","err","version","items","revalidateTag","tag","revalidatedAt","Date","now","mkdir","dirname","writeFile","console","warn","get","key","tags","softTags","fetchCache","process","env","NEXT_RUNTIME","filePath","getFsPath","pathname","fileData","readFile","mtime","stat","meta","replace","cacheEntry","lastModified","getTime","headers","status","_","isAppPath","parsedData","storedTags","every","includes","set","cacheTags","tagsHeader","split","isStale","some","undefined","combinedTags","wasRevalidated","htmlPath"],"mappings":"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"}