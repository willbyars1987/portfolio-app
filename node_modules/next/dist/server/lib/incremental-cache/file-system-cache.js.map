{"version":3,"sources":["../../../../src/server/lib/incremental-cache/file-system-cache.ts"],"names":["FileSystemCache","memoryCache","tagsManifest","constructor","ctx","fs","flushToDisk","serverDistDir","appDir","_appDir","revalidatedTags","maxMemoryCacheSize","LRUCache","max","length","value","JSON","kind","stringify","props","Error","data","body","html","pageData","tagsManifestPath","path","join","loadTagsManifest","parse","readFileSync","toString","err","version","items","revalidateTag","tag","revalidatedAt","Date","now","mkdir","dirname","writeFile","console","warn","get","key","tags","softTags","fetchCache","process","env","NEXT_RUNTIME","filePath","getFsPath","pathname","fileData","readFile","mtime","stat","meta","replace","cacheEntry","lastModified","getTime","headers","status","_","isAppPath","parsedData","storedTags","every","includes","set","cacheTags","tagsHeader","NEXT_CACHE_TAGS_HEADER","split","isStale","some","undefined","combinedTags","wasRevalidated","htmlPath"],"mappings":"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"}